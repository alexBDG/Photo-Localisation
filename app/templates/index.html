{% extends 'base.html' %}

{% block content %}

    <h1>Localisation de photos</h1>
    
    <p>Interface permettant l'extraction des données de localisation de vos photos.</p>
    
    <br>
    
    <br>
    
    <h2>Description</h2>
    
    <p>Vous avez à renseigner une image ou un dossier contenant des images (ou d'autres dossier d'images). Ensuite une carte sera générée.</p>
    
    <br>
    
    <br>
        
    <h2>Le logiciel</h2>

    <form action="/directory/" method="post"> 
        
        <h3>Selection : </h3>
        
        <div class="submit">
            <label for="path">Tout d'abord, selectionnez un dossier d'images :</label>
            <input type="submit" value="Recherche ..."/>
        </div>
        
    </form>
    
    <br>
    
    <br>
    
    <form action="/result/" method="post"> 
        
        <h3>Recherche : </h3>
        
        {% if path %}
            <p> &#10148; {{ path }} </p>
        {% else %}
            <p> &#10148; <i>Aucun dossier selectionné !</i> </p>
        {% endif %}
        
        <input for="path" name="path" style="display: none;" value="{{ path }}"/>
        <div class="form-submit-button">
            <input type="submit" value="C'est parti !"/>
        </div>
        
    </form>
    
    
    <head>
    </head>
    
    
    {% if path %}
        <div class="container">
        
            <script>
                alert("final");
                function check_progress() {
                    function worker() {
                        $.get('progress/1', function(data) {
                            if (progress < 100) {
                                $('.progress-bar').css('width', event.data + '%').attr('aria-valuenow', event.data);
                                $('.progress-bar-label').text(event.data+'%');
                                setTimeout(worker, 10)
                            }
                        })
                    }
                }
            </script>
            
            <body onload="check_progress();">
            
    <!--
            <script>
                var source = new EventSource("/result");
                eventSource.onopen = function () {
                  console.log("Sse connection opened");
                };
                eventSource.onerror = function () {
                  console.log("error occured");
                };
                eventSource.onmessage = function (event) {
                  console.log("received");
                };
                source.onmessage = function(event) {
                    $('.progress-bar').css('width', event.data + '%').attr('aria-valuenow', event.data);
                    $('.progress-bar-label').text(event.data+'%');
                    if(event.data == 100){
            			source.close()
            		}
                }
            </script>
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    //-->
            <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style_progress_bar.css') }}">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
            
            <div class="progress">
                <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
                    <span class="progress-bar-label">0%</span>
                </div>
            </div>
        </div>
    {% endif %}

    
{% endblock %}
 